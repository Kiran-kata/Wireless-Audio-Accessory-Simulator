# Architecture Visualization

## System Overview (ASCII Art)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    WIRELESS AUDIO ACCESSORY SIMULATOR                  â•‘
â•‘                          (AirPods-like System)                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HOST SIDE (macOS/Linux)                         â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     host_daemon Process                         â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“   â”â”â”â”â”â”â”â”â”â”â”â”â”“   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“    â”‚    â”‚
â”‚  â”‚   â”ƒ   Device     â”ƒ   â”ƒ   Audio   â”ƒ   â”ƒ   Telemetry     â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ   Manager    â”ƒ   â”ƒ   Sync    â”ƒ   â”ƒ   Processor     â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ              â”ƒ   â”ƒ           â”ƒ   â”ƒ                 â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ â€¢ Discovery  â”ƒ   â”ƒ â€¢ Jitter  â”ƒ   â”ƒ â€¢ Battery Log  â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ â€¢ Pairing    â”ƒ   â”ƒ   Buffer  â”ƒ   â”ƒ â€¢ Diagnostics  â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ â€¢ Connect    â”ƒ   â”ƒ â€¢ Reorder â”ƒ   â”ƒ â€¢ Alerts       â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ â€¢ Keepalive  â”ƒ   â”ƒ â€¢ Playbackâ”ƒ   â”ƒ                 â”ƒ    â”‚    â”‚
â”‚  â”‚   â”—â”â”â”â”â”â”¯â”â”â”â”â”â”â”â”â”›   â”—â”â”â”â”â”â”¯â”â”â”â”â”â”›   â”—â”â”â”â”â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”›    â”‚    â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚              â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚    â”‚
â”‚  â”‚                             â”‚                                  â”‚    â”‚
â”‚  â”‚                  â”â”â”â”â”â”â”â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”“                       â”‚    â”‚
â”‚  â”‚                  â”ƒ    Transport        â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ   (UDP Socket)      â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ                     â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ â€¢ TX Queue          â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ â€¢ RX Thread         â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ â€¢ Packet Routing    â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”—â”â”â”â”â”â”â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”›                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚
                    â•”â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘   Wireless Link        â•‘
                    â•‘   (Simulated BT)       â•‘
                    â•‘                        â•‘
                    â•‘   â€¢ UDP/IP             â•‘
                    â•‘   â€¢ Localhost          â•‘
                    â•‘   â€¢ ~2ms latency       â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               â”‚         ACCESSORY SIDE                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 accessory_simulator Process                    â”‚    â”‚
â”‚  â”‚              (Embedded Firmware Simulation)                    â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“   â”â”â”â”â”â”â”â”â”â”â”â”â”“   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“    â”‚    â”‚
â”‚  â”‚   â”ƒ Connection   â”ƒ   â”ƒ   Audio   â”ƒ   â”ƒ   Telemetry     â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ     FSM      â”ƒ   â”ƒ  Streamer â”ƒ   â”ƒ                 â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ              â”ƒ   â”ƒ           â”ƒ   â”ƒ â€¢ Battery Sim   â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ IDLE â”€â”€â”€â”€â”€â”€â–º â”ƒ   â”ƒ â€¢ 10ms    â”ƒ   â”ƒ â€¢ Voltage       â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ DISCOVERING  â”ƒ   â”ƒ   Timing  â”ƒ   â”ƒ â€¢ Current       â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ PAIRING      â”ƒ   â”ƒ â€¢ PCM Gen â”ƒ   â”ƒ â€¢ Drain Model   â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ CONNECTED    â”ƒ   â”ƒ â€¢ Seq #   â”ƒ   â”ƒ â€¢ Reports       â”ƒ    â”‚    â”‚
â”‚  â”‚   â”ƒ STREAMING â—„â”€â”€â”ƒ   â”ƒ           â”ƒ   â”ƒ                 â”ƒ    â”‚    â”‚
â”‚  â”‚   â”—â”â”â”â”â”â”¯â”â”â”â”â”â”â”â”â”›   â”—â”â”â”â”â”â”¯â”â”â”â”â”â”›   â”—â”â”â”â”â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”›    â”‚    â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚              â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚    â”‚
â”‚  â”‚                             â”‚                                  â”‚    â”‚
â”‚  â”‚                  â”â”â”â”â”â”â”â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”“                       â”‚    â”‚
â”‚  â”‚                  â”ƒ    Transport        â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ   (UDP Socket)      â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ                     â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ â€¢ Bind Port 8888    â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ â€¢ TX/RX Threads     â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”ƒ â€¢ Packet Routing    â”ƒ                       â”‚    â”‚
â”‚  â”‚                  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›                       â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“                                              â”‚    â”‚
â”‚  â”‚  â”ƒ    Crypto    â”ƒ  (Simulated Security)                        â”‚    â”‚
â”‚  â”‚  â”ƒ              â”ƒ                                              â”‚    â”‚
â”‚  â”‚  â”ƒ â€¢ ECDH       â”ƒ  Ready for mbedTLS                           â”‚    â”‚
â”‚  â”‚  â”ƒ â€¢ AES-128    â”ƒ  or hardware crypto                          â”‚    â”‚
â”‚  â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Communication Flow

```
DISCOVERY PHASE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Host                                         Accessory
  â”‚                                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€ DISCOVER_REQUEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                              â”œâ”€ Check state = IDLE
  â”‚                                              â”œâ”€ Transition to DISCOVERING
  â”‚                                              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ DISCOVER_RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚          (device_name, battery, caps)        â”‚
  â”‚                                              â”‚
  â”œâ”€ Add to device list                         â”‚
  â”œâ”€ Display to user                            â”‚
  â”‚                                              â”‚


PAIRING PHASE:
â•â•â•â•â•â•â•â•â•â•â•â•â•

Host                                         Accessory
  â”‚                                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€ PAIR_REQUEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚          (host_public_key)                   â”œâ”€ Generate key pair
  â”‚                                              â”œâ”€ Derive shared secret
  â”‚                                              â”œâ”€ Transition to PAIRING
  â”‚                                              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PAIR_RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚          (accessory_public_key)              â”‚
  â”‚                                              â”‚
  â”œâ”€ Derive shared secret                       â”‚
  â”œâ”€ Store credentials                          â”‚
  â”‚                                              â”‚


CONNECTION PHASE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Host                                         Accessory
  â”‚                                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€ CONNECT_REQUEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                              â”œâ”€ Validate session
  â”‚                                              â”œâ”€ Start keepalive thread
  â”‚                                              â”œâ”€ Start telemetry
  â”‚                                              â”œâ”€ Transition to CONNECTED
  â”‚                                              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ CONNECT_RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                              â”‚
  â”œâ”€ Start keepalive thread                     â”‚
  â”œâ”€ Transition to CONNECTED                    â”‚
  â”‚                                              â”‚
  â”‚                                              â”œâ”€ Auto-start streaming
  â”‚                                              â”œâ”€ Transition to STREAMING
  â”‚                                              â”‚


STREAMING PHASE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Host                                         Accessory
  â”‚                                              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ AUDIO_DATA (seq=0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”
  â”œâ”€ Buffer [0]                                  â”‚  â”‚ 10ms timer
  â”‚                                              â”‚  â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ AUDIO_DATA (seq=1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”œâ”€ Buffer [0,1]                                â”‚  â”‚
  â”‚                                              â”‚  â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ AUDIO_DATA (seq=2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”œâ”€ Buffer [0,1,2] FULL!                        â”‚  â”‚
  â”œâ”€ Play seq=0 â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚  â”‚
  â”‚                      â”‚                        â”‚  â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ AUDIO_DATA (seq=3) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”˜
  â”œâ”€ Buffer [1,2,3]                              â”‚
  â”œâ”€ Play seq=1 â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
  â”‚                                              â”‚
  â”œâ—„â”€â”€â”€â”€â”€â”€â”€â”€â–º KEEPALIVE â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚           (every 1 second)                   â”‚
  â”‚                                              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ BATTERY_STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”œâ”€ Log telemetry                               â”‚
  â”‚                                              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ DIAGNOSTICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”œâ”€ Log diagnostics                             â”‚
  â”‚                                              â”‚


ERROR RECOVERY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Host                                         Accessory
  â”‚                                              â”‚
  â”‚  [Connection Lost - Network Issue]          â”‚
  â”‚                                              â”‚
  â”œâ”€ Keepalive timeout (5s)                     â”œâ”€ Keepalive timeout (5s)
  â”œâ”€ Transition to ERROR                        â”œâ”€ Transition to ERROR
  â”œâ”€ Stop audio sync                            â”œâ”€ Stop audio streaming
  â”‚                                              â”‚
  â”‚                                              â”œâ”€ Attempt #1 (100ms delay)
  â”‚                                              â”œâ”€ Transition to IDLE
  â”‚                                              â”‚
  â”œâ”€ Restart discovery                          â”‚
  â”‚                                              â”‚
  â”‚  [Network Restored]                         â”‚
  â”‚                                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€ DISCOVER_REQUEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ DISCOVER_RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€ PAIR_REQUEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ PAIR_RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€ CONNECT_REQUEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ CONNECT_RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                              â”‚
  â”œâ”€ Transition to CONNECTED                    â”œâ”€ Transition to CONNECTED
  â”‚                                              â”œâ”€ Resume STREAMING
  â”‚                                              â”‚
  â”œâ”€ Start audio sync                           â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ AUDIO_DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                              â”‚
  [Connection Restored - Total: ~400ms]         â”‚
```

## Thread Architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ACCESSORY SIMULATOR                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Main Thread  â”‚  Priority: NORMAL
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  Role: Initialization, coordination
        â”‚
        â”œâ”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Transport RX       â”‚  Priority: HIGH
        â”‚      â”‚ Thread             â”‚  Role: Receive packets
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Blocking: recvfrom()
        â”‚
        â”œâ”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Transport TX       â”‚  Priority: NORMAL
        â”‚      â”‚ Thread             â”‚  Role: Send packets
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Blocking: send queue CV
        â”‚
        â”œâ”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Audio Streaming    â”‚  Priority: HIGH (RT)
        â”‚      â”‚ Thread             â”‚  Role: Generate audio @ 10ms
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Timing: sleep_until()
        â”‚
        â”œâ”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Telemetry Thread   â”‚  Priority: LOW
        â”‚      â”‚                    â”‚  Role: Battery/diag reports
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Rate: 0.2-1 Hz
        â”‚
        â””â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Keepalive Thread   â”‚  Priority: NORMAL
               â”‚                    â”‚  Role: Monitor connection
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Rate: 1 Hz


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        HOST DAEMON                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Main Thread  â”‚  Priority: NORMAL
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  Role: Initialization, status reporting
        â”‚
        â”œâ”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Transport RX       â”‚  Priority: HIGH
        â”‚      â”‚ Thread             â”‚  Role: Receive packets
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Blocking: recvfrom()
        â”‚
        â”œâ”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Transport TX       â”‚  Priority: NORMAL
        â”‚      â”‚ Thread             â”‚  Role: Send packets
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Blocking: send queue CV
        â”‚
        â”œâ”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Discovery Thread   â”‚  Priority: LOW
        â”‚      â”‚                    â”‚  Role: Find devices
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Rate: 0.5 Hz
        â”‚
        â”œâ”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Audio Sync Thread  â”‚  Priority: HIGH
        â”‚      â”‚                    â”‚  Role: Jitter buffer, playback
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Event-driven + polling
        â”‚
        â””â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Keepalive Thread   â”‚  Priority: NORMAL
               â”‚                    â”‚  Role: Send keepalives
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Rate: 1 Hz

Thread Synchronization:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Atomic<T> for state flags
â€¢ std::mutex for shared data
â€¢ std::condition_variable for event notification
â€¢ Lock-free reads where possible
```

## File Organization

```
Wireless Audio Accessory Simulator/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                    â† Project overview
â”œâ”€â”€ ğŸ“„ QUICK_START.md               â† Quick reference
â”œâ”€â”€ ğŸ“„ PROJECT_SUMMARY.md           â† This document
â”œâ”€â”€ ğŸ“„ CMakeLists.txt               â† Build configuration
â”œâ”€â”€ ğŸ“œ build.sh / build.bat         â† Build scripts
â”œâ”€â”€ ğŸ“œ .gitignore                   â† Version control
â”‚
â”œâ”€â”€ ğŸ“ accessory/                   â† ACCESSORY SIDE
â”‚   â”œâ”€â”€ ğŸ“ include/accessory/
â”‚   â”‚   â”œâ”€â”€ ğŸ”§ connection_fsm.h     â† State machine
â”‚   â”‚   â”œâ”€â”€ ğŸ”§ audio_streamer.h     â† Audio generation
â”‚   â”‚   â”œâ”€â”€ ğŸ”§ telemetry.h          â† Battery/diag
â”‚   â”‚   â”œâ”€â”€ ğŸ”§ transport.h          â† Network layer
â”‚   â”‚   â””â”€â”€ ğŸ”§ crypto.h             â† Security
â”‚   â””â”€â”€ ğŸ“ src/
â”‚       â”œâ”€â”€ ğŸ’» main.cpp             â† Entry point
â”‚       â”œâ”€â”€ ğŸ’» connection_fsm.cpp   â† FSM implementation
â”‚       â”œâ”€â”€ ğŸ’» audio_streamer.cpp   â† Audio logic
â”‚       â”œâ”€â”€ ğŸ’» telemetry.cpp        â† Telemetry logic
â”‚       â”œâ”€â”€ ğŸ’» transport.cpp        â† UDP socket
â”‚       â””â”€â”€ ğŸ’» crypto.cpp           â† Crypto ops
â”‚
â”œâ”€â”€ ğŸ“ host/                        â† HOST SIDE
â”‚   â”œâ”€â”€ ğŸ“ include/host/
â”‚   â”‚   â”œâ”€â”€ ğŸ”§ device_manager.h     â† Discovery/pairing
â”‚   â”‚   â”œâ”€â”€ ğŸ”§ audio_sync.h         â† Jitter buffer
â”‚   â”‚   â”œâ”€â”€ ğŸ”§ telemetry_processor.h â† Telemetry logs
â”‚   â”‚   â””â”€â”€ ğŸ”§ transport.h          â† Network layer
â”‚   â””â”€â”€ ğŸ“ src/
â”‚       â”œâ”€â”€ ğŸ’» main.cpp             â† Daemon entry
â”‚       â”œâ”€â”€ ğŸ’» device_manager.cpp   â† Device mgmt
â”‚       â”œâ”€â”€ ğŸ’» audio_sync.cpp       â† Sync logic
â”‚       â”œâ”€â”€ ğŸ’» telemetry_processor.cpp â† Log processing
â”‚       â””â”€â”€ ğŸ’» transport.cpp        â† UDP socket
â”‚
â”œâ”€â”€ ğŸ“ common/                      â† SHARED PROTOCOL
â”‚   â”œâ”€â”€ ğŸ“ include/
â”‚   â”‚   â””â”€â”€ ğŸ”§ protocol.h           â† Packet definitions
â”‚   â””â”€â”€ ğŸ“ src/
â”‚       â””â”€â”€ ğŸ’» protocol.cpp         â† Serialization
â”‚
â””â”€â”€ ğŸ“ docs/                        â† DOCUMENTATION
    â”œâ”€â”€ ğŸ“˜ architecture.md          â† System design
    â”œâ”€â”€ ğŸ“˜ timing_diagram.md        â† Latency analysis
    â”œâ”€â”€ ğŸ“˜ state_machine.md         â† FSM docs
    â”œâ”€â”€ ğŸ“˜ testing.md               â† Test scenarios
    â””â”€â”€ ğŸ“˜ architecture_visual.md   â† This file
```

---

**Total Project**: 22 source files, 7 documentation files, ~12,000 lines
